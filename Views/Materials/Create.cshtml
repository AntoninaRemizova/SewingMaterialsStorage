@model SewingMaterialsStorage.Models.Material
@{
    ViewData["Title"] = "Добавить материал";
}

<div class="container mt-4">
    <h2 class="mb-4">@ViewData["Title"]</h2>

    <form asp-action="Create" method="post" id="materialForm">
        <!-- Основные данные -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">Основная информация</div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label asp-for="MaterialName" class="form-label"></label>
                        <input asp-for="MaterialName" class="form-control" required>
                        <span asp-validation-for="MaterialName" class="text-danger"></span>
                    </div>

                    <div class="col-md-6">
                        <label asp-for="Article" class="form-label"></label>
                        <input asp-for="Article" class="form-control">
                    </div>

                    <div class="col-md-6">
                        <label asp-for="PricePerUnit" class="form-label"></label>
                        <input asp-for="PricePerUnit" type="number" step="0.01"
                               class="form-control" min="0.01" required>
                        <span asp-validation-for="PricePerUnit" class="text-danger"></span>
                    </div>

                    <div class="col-md-6">
                        <label asp-for="MinThreshold" class="form-label"></label>
                        <input asp-for="MinThreshold" type="number" class="form-control"
                               min="1" required>
                        <span asp-validation-for="MinThreshold" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Производитель -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">Производитель</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <label class="form-label">Производитель</label>
                        <select asp-for="ManufacturerId" asp-items="ViewBag.Manufacturers"
                                class="form-select" id="manufacturerSelect">
                            <option value="">-- Выберите --</option>
                        </select>
                        <div class="mt-2">
                            <a asp-controller="Manufacturers" asp-action="Create"
                               class="btn btn-sm btn-outline-primary"
                               target="_blank">
                                <i class="bi bi-plus-circle"></i> Добавить нового
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Цвета и состав -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">Характеристики</div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Цвета</label>
                        <select asp-for="Colors" class="form-select" multiple
                                asp-items="ViewBag.Colors" size="5"
                                name="selectedColors"></select>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Состав</label>
                        <select asp-for="Compositions" class="form-select" multiple
                                asp-items="ViewBag.Compositions" size="5"
                                name="selectedCompositions"></select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Специфические характеристики -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">Спецификация</div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label asp-for="TypeId" class="form-label"></label>
                        <select asp-for="TypeId" asp-items="ViewBag.MaterialTypes"
                                class="form-select" id="typeSelect" required>
                            <option value="">-- Выберите тип --</option>
                        </select>
                        <span asp-validation-for="TypeId" class="text-danger"></span>
                    </div>

                    <div id="dynamicFields" class="row g-3 mt-2"></div>
                </div>
            </div>
        </div>

        <div class="text-end">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-save"></i> Сохранить
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        // Динамическая загрузка характеристик
        document.getElementById('typeSelect').addEventListener('change', function () {
            const typeId = this.value;
            fetch(`/Materials/GetTypeFields?typeId=${typeId}`)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('dynamicFields').innerHTML = html;
                });
        });

        // Обновление списка производителей после добавления
        document.getElementById('manufacturerSelect').addEventListener('focus', function () {
            fetch('/Manufacturers/GetManufacturers')
                .then(response => response.json())
                .then(data => {
                    const select = document.getElementById('manufacturerSelect');
                    select.innerHTML = '<option value="">-- Выберите --</option>';
                    data.forEach(item => {
                        const option = new Option(item.text, item.value);
                        select.add(option);
                    });
                });
        });
    </script>
}